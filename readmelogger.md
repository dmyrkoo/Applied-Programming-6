README — Logger (Log4j2) for Railway Management

Мета

Додати централізоване логування в проєкт, щоб:
- Записувати всі важливі дії і статуси (INFO+ в файл).
- Фіксувати попередження (WARN) та помилки (ERROR/FATAL).
- Надсилати критичні помилки (ERROR/FATAL) на електронну пошту через SMTP (при необхідності).

Що я додав у проєкт

1) Залежності (в `pom.xml`): log4j-core, log4j-api, log4j-slf4j-impl та jakarta.mail (com.sun.mail). Вони потрібні для роботи Log4j2 і SMTP appender.

2) Файли конфігурації:
- `src/main/resources/log4j2.xml` — основна конфігурація логера (FileAppender + SMTPAppender + Console optional).
- `src/test/resources/log4j2-test.xml` — тестова конфігурація (ні за яких умов не відправляє листи; тільки консоль на рівні WARN), щоб уникнути спаму пошти під час юніт-тестів.

3) Приклади інтеграції в код (у вашому проєкті `SkladService` вже містить Logger):
- Ініціалізація:
  private static final Logger logger = LogManager.getLogger(ClassName.class);

- Логування успіхів/дій:
  logger.info("Потяг успішно створено: {}", train.getName());

- Логування попереджень/некритичних проблем:
  logger.warn("Некоректні дані: {}", input);

- Логування помилок (разом зі стек-трейсом):
  logger.error("Помилка при збереженні", e);

Де змінювати параметри пошти

Відкрийте `src/main/resources/log4j2.xml` і замініть плейсхолдери:
- `from` — ваш email (наприклад, ваш@gmail.com)
- `to` — куди надсилати помилки
- `smtpUsername` — ваш email (зазвичай той самий)
- `smtpPassword` — пароль додатка (App Password) або інший механізм авторизації

Примітки про Gmail

Gmail вимагає App Password для сторонніх додатків, якщо ввімкнено двофакторну автентифікацію. Також можете використовувати корпоративний SMTP або інший проксі-поштовий сервер.

Як тестувати логування

1) Переконайтесь, що у вас створена папка `logs/` або записи в `log4j2.xml` вказують відносний шлях `logs/application.log`.
2) Запустіть програму: при успішних діях у `logs/application.log` з'являться рядки INFO.
3) Для тестування відправки листа тимчасово згенеруйте помилку:
   try { throw new RuntimeException("SMTP test"); } catch (Exception e) { logger.error("Тестова помилка для перевірки пошти", e); }
   Пам'ятайте: не використовуйте це під час запуску тестів — тестова конфігурація блокує SMTP.

Примітка щодо тестів (уникнення спаму пошти)

- Log4j2 автоматично використовує `log4j2-test.xml` з `src/test/resources` під час запуску тестів — тому SMTP не спрацює під час `mvn test`.

Якщо щось не працює

- Перевірте, чи файл `log4j2.xml` читається (у ресурсах). Логи при запуску Log4j2 з параметром `status` у конфігурації покажуть помилки.
- Перевірте доступ до smtp сервера (порт 587 для TLS).

Файли, які створено/змінено

- `pom.xml` (argLine для Surefire, log4j2 залежності вже були додані)
- `src/main/resources/log4j2.xml`
- `src/test/resources/log4j2-test.xml`

Дальші кроки (рекомендації)

- Зберігайте SMTP дані в зовнішньому конфіг-файлі або у змінних середовища, а не у репозиторії.
- Для продакшн середовища налаштуйте безпечний зберігання секретів (Vault, env vars, CI secrets).

Контакти

Якщо хочете — я можу допомогти інтегрувати відправку через API (SendGrid, Mailgun) або налаштувати лог-ретеншн/ротацію для `application.log`.

